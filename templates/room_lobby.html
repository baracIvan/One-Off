<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Room Lobby - One Off</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="room-header">
        <div class="room-info">
            <p><strong>Room Code:</strong> {{ room.code }}</p>
            <p><strong>Answer:</strong> {{ room.timers['answer'] }}s</p>
            <p><strong>Discussion:</strong> {{ room.timers['discussion'] }}s</p>
            <p><strong>Voting:</strong> {{ room.timers['voting'] }}s</p>
            <p><strong>Rounds:</strong> {{ room.max_rounds }}</p>
        </div>
    </div>

    <h1>Players: <span id="player-count"></span></h1>
    <ul class="player-list" id="player-list">
    </ul>


    <form method="POST" action="/leave_room">
        <input type="hidden" name="room_code" value="{{ room.code }}">
        <input type="hidden" name="nickname" value="{{ nickname }}">
        <button class="button leave-button">Leave Room</button>
    </form>

    <form action="/start_game/{{ room.code }}" method="POST" id="start-game-form" style="display: none;">
        <button class="button">Start Game</button>
    </form>


    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const socket = io();
        let mySocketId = null;

        const roomCode = "{{ room.code }}";
        const nickname = "{{ nickname }}";


        socket.on('connect', () => {
            mySocketId = socket.id;
            console.log('[Socket] Connected with ID:', mySocketId);
            socket.emit('join_lobby', { room_code: roomCode, nickname: nickname });
        });


        socket.on('update_player_list', data => {
            const list = document.getElementById('player-list');
            const count = document.getElementById('player-count');
            const startForm = document.getElementById('start-game-form');

            list.innerHTML = '';

            console.log('[update_player_list] Host SID:', data.host_sid);
            console.log('[update_player_list] My SID:', mySocketId);

            data.players.forEach(name => {
                const li = document.createElement('li');
                const crown = name === data.players[0] ? ' ðŸ‘‘' : '';
                li.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" fill="black" viewBox="0 0 24 24">
                        <circle cx="12" cy="8" r="4"/>
                        <path d="M12 14c-5 0-8 2-8 4v2h16v-2c0-2-3-4-8-4z"/>
                    </svg>
                    ${name}${crown}
                `;
                list.appendChild(li);
            });

            count.textContent = data.players.length;

            // âœ… Show/hide Start Game button
            if (mySocketId && data.host_sid === mySocketId) {
                console.log('[UI] You are the host â€” showing Start Game button');
                startForm.style.display = 'block';
            } else {
                console.log('[UI] Not host â€” hiding Start Game button');
                startForm.style.display = 'none';
            }
        });



    </script>

</body>
</html>
